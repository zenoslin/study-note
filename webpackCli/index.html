<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>用 webpack 搭建 Ming-cli | Zenos Note</title>
    <meta name="description" content="一些学习笔记">
    <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="description" itemprop="description" content="一些学习笔记">
    
    <link rel="preload" href="/note/assets/css/0.styles.3e02f63c.css" as="style"><link rel="preload" href="/note/assets/js/app.636a47c6.js" as="script"><link rel="preload" href="/note/assets/js/2.36009e24.js" as="script"><link rel="preload" href="/note/assets/js/12.2725cf1e.js" as="script"><link rel="prefetch" href="/note/assets/js/10.6549388d.js"><link rel="prefetch" href="/note/assets/js/11.db2c79ca.js"><link rel="prefetch" href="/note/assets/js/13.60741dd3.js"><link rel="prefetch" href="/note/assets/js/3.8cc5e810.js"><link rel="prefetch" href="/note/assets/js/4.aac0cde1.js"><link rel="prefetch" href="/note/assets/js/5.57decd70.js"><link rel="prefetch" href="/note/assets/js/6.1576a5c9.js"><link rel="prefetch" href="/note/assets/js/7.1665c743.js"><link rel="prefetch" href="/note/assets/js/8.97b5f2b6.js"><link rel="prefetch" href="/note/assets/js/9.17d5a17d.js">
    <link rel="stylesheet" href="/note/assets/css/0.styles.3e02f63c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/note/" class="home-link router-link-active"><!----> <span class="site-name">Zenos Note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://zenoslin.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/zenoslin/study-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://zenoslin.top" target="_blank" rel="noopener noreferrer" class="nav-link external">
  blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://github.com/zenoslin/study-note" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>杂谈</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/note/neteaseMusic/" class="sidebar-link">我在网易云听周杰伦</a></li><li><a href="/note/emoji/" class="sidebar-link">有趣！把 Emoji 动画加到你的地址栏和标题里</a></li><li><a href="/note/retina/" class="sidebar-link">开启 Macbook 外接显示器的 Retina 模式</a></li><li><a href="/note/https/" class="sidebar-link">2分钟获得HTTPS证书</a></li><li><a href="/note/imagemin/" class="sidebar-link">压缩图片桌面应用</a></li><li><a href="/note/webpackCli/" class="active sidebar-link">用 webpack 搭建 Ming-cli</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/note/webpackCli/#业务需求" class="sidebar-link">业务需求</a></li><li class="sidebar-sub-header"><a href="/note/webpackCli/#安装起步" class="sidebar-link">安装起步</a></li><li class="sidebar-sub-header"><a href="/note/webpackCli/#typescript-支持" class="sidebar-link">TypeScript 支持</a></li><li class="sidebar-sub-header"><a href="/note/webpackCli/#分包" class="sidebar-link">分包</a></li><li class="sidebar-sub-header"><a href="/note/webpackCli/#断点调试" class="sidebar-link">断点调试</a></li><li class="sidebar-sub-header"><a href="/note/webpackCli/#重新加载" class="sidebar-link">重新加载</a></li></ul></li><li><a href="/note/layabox/" class="sidebar-link">mac下layabox编译环境配置笔记</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="用-webpack-搭建-ming-cli"><a href="#用-webpack-搭建-ming-cli" aria-hidden="true" class="header-anchor">#</a> 用 webpack 搭建 Ming-cli</h1> <p>因为从 AS3 语言向 TS 转型，选用 webpack 作为打包工具，可以省略 LayaCMD 的编译时间从而高效率的提高工作效率。</p> <h2 id="业务需求"><a href="#业务需求" aria-hidden="true" class="header-anchor">#</a> 业务需求</h2> <ul><li>[x] TS 支持</li> <li>[x] 分包</li> <li>[x] 断点调试</li> <li>[x] 重新加载</li></ul> <h2 id="安装起步"><a href="#安装起步" aria-hidden="true" class="header-anchor">#</a> 安装起步</h2> <p><code>npm</code>（node package manager）是 nodejs 的包管理器，用于 node 插件管理（包括安装、卸载、管理依赖等），npm 安装插件过程：从<a href="http://registry.npmjs.org" target="_blank" rel="noopener noreferrer">http://registry.npmjs.org<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 下载对应的插件包（该网站服务器位于国外，所以经常下载缓慢或出现异常）
这时候我们就需要用到<code>cnpm</code>。</p> <p><code>cnpm</code>是淘宝镜像服务器,来自官网：“这是一个完整<code>npmjs.org</code>镜像，你可以用此代替官方版本(只读)，同步频率目前为 10 分钟 一次以保证尽量与官方服务同步。”</p> <div class="language-- sh extra-class"><pre class="language-text"><code>npm install -g cnpm --registry=https://registry.npm.taobao.org
</code></pre></div><p>开始安装<code>webpack</code>，目前最新的<code>webpack</code>版本为<code>v4.27.1</code>,因为使用版本为<code>webpack 4+</code>，还需要安装 CLI</p> <div class="language-- sh extra-class"><pre class="language-text"><code>npm install --save-dev webpack
npm install --save-dev webpack-cli
</code></pre></div><p>安装完成后，做些准备工作。打开<code>package.json</code></p> <ul><li>删除入口<code>&quot;main&quot;: &quot;index.js&quot;</code></li> <li>添加<code>&quot;private&quot;: true</code>防止意外发布。</li> <li>添加<code>&quot;build&quot;: &quot;webpack&quot;</code>npm 脚本快捷发布</li></ul> <div class="language-- json extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;Ming-cli&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;zenosLin&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;webpack&quot;: &quot;^4.27.1&quot;,
    &quot;webpack-cli&quot;: &quot;^3.1.2&quot;
  }
}
</code></pre></div><p>新建配置文件<code>webpack.config.js</code></p> <div class="language-- javascript extra-class"><pre class="language-text"><code>const path = require('path');

module.exports = {
  entry: './src/index.js',
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
</code></pre></div><p>现在一个由<code>webpack</code>组成的脚手架工具雏形已经完成。
如果需要在 js 中打包<code>lodash</code>依赖，我们需要在本地安装 library</p> <div class="language--sh extra-class"><pre class="language-text"><code>npm install --save lodash
</code></pre></div><p>并在 js 文件中<code>import _ from 'lodash'</code></p> <h2 id="typescript-支持"><a href="#typescript-支持" aria-hidden="true" class="header-anchor">#</a> TypeScript 支持</h2> <p>安装 TypeScript 编译器和 loader：</p> <div class="language-- sh extra-class"><pre class="language-text"><code>npm install --save-dev typescript ts-loader
</code></pre></div><p>新建<code>tsconfig.json</code>文件</p> <p>设置一个基本的配置，来支持 JSX，并将 TypeScript 编译到 ES5</p> <div class="language-- json extra-class"><pre class="language-text"><code>{
  &quot;compilerOptions&quot;: {
    &quot;outDir&quot;: &quot;./dist/&quot;,
    &quot;noImplicitAny&quot;: true,
    &quot;module&quot;: &quot;es6&quot;,
    &quot;target&quot;: &quot;es5&quot;,
    &quot;jsx&quot;: &quot;react&quot;,
    &quot;allowJs&quot;: true
  }
}
</code></pre></div><p>修改<code>webpack.config.js</code></p> <p>将<code>webpack</code>的入口起点指定为<code>./index.ts</code>，然后通过<code>ts-loader</code>加载所有的<code>.ts</code>和<code>.tsx</code>文件，并且在当前目录输出一个<code>bundle.js</code>文件</p> <div class="language-- javascript extra-class"><pre class="language-text"><code>const path = require('path');

module.exports = {
  entry: './src/index.ts',
  module: {
    rules: [
      {
        test: /\.tsx?$/,
        use: 'ts-loader',
        exclude: /node_modules/
      }
    ]
  },
  resolve: {
    extensions: [ '.tsx', '.ts', '.js' ]
  },
  output: {
    filename: 'bundle.js',
    path: path.resolve(__dirname, 'dist')
  }
};
</code></pre></div><p>这样我们就完成了对 TypeScript 的支持。</p> <h2 id="分包"><a href="#分包" aria-hidden="true" class="header-anchor">#</a> 分包</h2> <p>接下来利用<code>webpack</code>多入口的属性来实现分包功能。先模拟工作路径创建一些<code>ts</code>文件来尝试分包。</p> <div class="language-- en extra-class"><pre class="language-text"><code>  webpack-demo
  |- package.json
  |- tsconfig.json
  |- webpack.config.js
  |- /bin
    |- index.html
  |- /src
    |- main.ts
    |- com
       |- print.ts
  |- /minggame
    |- src
      |- minggame.ts
      |- com
        |- print.st
  |- /node_modules
</code></pre></div><p><code>index.html</code></p> <div class="language--html extra-class"><pre class="language-text"><code>&lt;!doctype html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;title&gt;Ming-cli&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;script src=&quot;./main.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre></div><p>完成工作路径的搭建之后，我们开始修改<code>webpack.config.js</code>，将入口设置为多个入口文件，并将它们分开<code>js</code>打包，并以不同的名称命名。在这里我们为了查看打包后的<code>js</code>文件是否正确，需要设置<code>mode</code>为<code>development</code>解除代码压缩，最新的<code>webpack</code>是默认用<code>UglifyJsPlugin</code>压缩代码的。</p> <div class="language-- javascript extra-class"><pre class="language-text"><code>const path = require('path');

module.exports = {
    entry: {
        main: './src/main.ts',
        minggame: &quot;./minggame/src/minggame.ts&quot;
    },
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: 'ts-loader',
                exclude: /node_modules/
            }
        ]
    },
    resolve: {
        extensions: [ '.tsx', '.ts', '.js' ]
    },
    output: {
        filename: '[name].js',
        path: path.resolve(__dirname, 'bin')
    },
      mode: 'development'
};
</code></pre></div><h2 id="断点调试"><a href="#断点调试" aria-hidden="true" class="header-anchor">#</a> 断点调试</h2> <p>当<code>webpack</code>打包源代码时，可能会很难追踪到错误和警告在源代码中的原始位置。为了更容易地追踪错误和警告，<code>JavaScript</code>提供了 <code>source map</code>功能，将编译后的代码映射回原始源代码。</p> <p>这时候我们需要修改<code>webpack.config.js</code>文件，使用<code>inline-source-map</code>选项。</p> <div class="language-- JavaScript extra-class"><pre class="language-text"><code>const path = require('path');

module.exports = {
    entry: {
        main: './src/main.ts',
        minggame: &quot;./minggame/src/minggame.ts&quot;
    },
    devtool: 'inline-source-map',
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: 'ts-loader',
                exclude: /node_modules/
            }
        ]
    },
    resolve: {
        extensions: [ '.tsx', '.ts', '.js' ]
    },
    output: {
        filename: '[name].js',
        path: path.resolve(__dirname, 'bin')
    }
};
</code></pre></div><h2 id="重新加载"><a href="#重新加载" aria-hidden="true" class="header-anchor">#</a> 重新加载</h2> <p>每次都去重新编译刷新浏览器很影响我们的工作效率，所以<code>webpack-dev-server</code>为我们提供了一个简单的<code>web</code>服务器，并且能够实时重新加载(live reloading)。</p> <div class="language-- shell extra-class"><pre class="language-text"><code>npm install --save-dev webpack-dev-server
</code></pre></div><p>修改<code>webpack.config.js</code>设置入口</p> <div class="language-- JavaScript extra-class"><pre class="language-text"><code>const path = require('path');

module.exports = {
    entry: {
        main: './src/main.ts',
        minggame: &quot;./minggame/src/minggame.ts&quot;
    },
    devtool: 'inline-source-map',
    devServer: {
        contentBase: './dist'
    },
    module: {
        rules: [
            {
                test: /\.tsx?$/,
                use: 'ts-loader',
                exclude: /node_modules/
            }
        ]
    },
    resolve: {
        extensions: [ '.tsx', '.ts', '.js' ]
    },
    output: {
        filename: '[name].js',
        path: path.resolve(__dirname, 'bin')
    }
};
</code></pre></div><p>然后我们在<code>package.json</code>中增加一个脚本直接打开开发服务器。</p> <div class="language-- json extra-class"><pre class="language-text"><code>{
  &quot;name&quot;: &quot;Ming-cli&quot;,
  &quot;version&quot;: &quot;1.0.0&quot;,
  &quot;description&quot;: &quot;&quot;,
  &quot;private&quot;: true,
  &quot;scripts&quot;: {
    &quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;,
    &quot;start&quot;: &quot;webpack-dev-server --open&quot;,
    &quot;build&quot;: &quot;webpack&quot;
  },
  &quot;keywords&quot;: [],
  &quot;author&quot;: &quot;zenosLin&quot;,
  &quot;license&quot;: &quot;ISC&quot;,
  &quot;devDependencies&quot;: {
    &quot;ts-loader&quot;: &quot;^5.3.1&quot;,
    &quot;typescript&quot;: &quot;^3.2.2&quot;,
    &quot;webpack&quot;: &quot;^4.27.1&quot;,
    &quot;webpack-cli&quot;: &quot;^3.1.2&quot;,
    &quot;webpack-dev-server&quot;: &quot;^3.1.14&quot;
  }
}

</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/note/imagemin/" class="prev">
          压缩图片桌面应用
        </a></span> <span class="next"><a href="/note/layabox/">
          mac下layabox编译环境配置笔记
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/note/assets/js/app.636a47c6.js" defer></script><script src="/note/assets/js/2.36009e24.js" defer></script><script src="/note/assets/js/12.2725cf1e.js" defer></script>
  </body>
</html>
